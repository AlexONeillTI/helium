{"version":3,"file":"hydrate-content-b33ed1f2.js","sources":["../../packages/content/src/utilities/hydrate-content/types.ts","../../packages/content/src/utilities/hydrate-content/hydrate-content.ts"],"sourcesContent":["import { Content } from '../../graphql/global-types';\n\nexport enum AvailabilityStatus {\n  Completed = 'completed',\n  Available = 'available',\n  Started = 'started',\n  NotStarted = 'not-started',\n  NotCompleted = 'not-completed'\n}\n\nexport type ContentItem = Content;\n\nexport type HydratedContentItem = ContentItem & {\n  hasUnmetPrerequisites: boolean;\n  isActive: boolean;\n  hasAvailability: boolean;\n  isCompleted: boolean;\n  isAvailable: boolean;\n  isStarted: boolean;\n  isNotStarted: boolean;\n  isNotCompleted: boolean;\n  kindIsScormOrXApi: boolean;\n  locationIsOnline: boolean;\n  locationIsInPerson: boolean;\n  usesContentAccessText: boolean;\n  callToAction: string;\n  href: string;\n  priceInCents?: number;\n  suggestedRetailPriceInCents?: number;\n  displayCourse?: string;\n};\n","import { i18n as I18n } from 'i18next';\nimport { ContentItem, HydratedContentItem, AvailabilityStatus } from './types';\nimport { ContentKind, AlternativePricingType } from '../../graphql/global-types';\nimport courseRuns from './course-run';\nimport { formatTime } from '../format-time';\n\n/**\n * Hydrate queried content item\n * @param i18n I18n instance\n * @param contentItem Content Item\n * @param companyTimeZone Company time zone\n * @param customFields Custom fields\n * @returns Hydrated content item\n */\nconst hydrateContentItem = (\n  i18n: I18n,\n  contentItem: ContentItem,\n  companyTimeZone: string | undefined = undefined,\n  customFields: any = {}\n): HydratedContentItem => {\n  const hasUnmetPrerequisites =\n    (contentItem.currentUserUnmetCoursePrerequisites || []).length > 0 ||\n    (contentItem.currentUserUnmetLearningPathPrerequisites || []).length > 0;\n\n  const isActive =\n    !contentItem.coursePresold && !contentItem.courseGracePeriodEnded && !hasUnmetPrerequisites;\n\n  const timeZone = companyTimeZone ?? contentItem.timeZone;\n\n  const hasAvailability = !!contentItem.availabilityStatus;\n  const isCompleted = contentItem.availabilityStatus === AvailabilityStatus.Completed;\n  const isAvailable = contentItem.availabilityStatus === AvailabilityStatus.Available;\n  const isStarted = contentItem.availabilityStatus === AvailabilityStatus.Started;\n  const isNotStarted = contentItem.availabilityStatus === AvailabilityStatus.NotStarted;\n  const isNotCompleted = contentItem.availabilityStatus === AvailabilityStatus.NotCompleted;\n\n  const kindIsScormOrXApi =\n    contentItem.kind === ContentKind.ShareableContentObject ||\n    contentItem.kind === ContentKind.XApiObject;\n  const locationIsOnline =\n    contentItem.kind === ContentKind.Webinar || contentItem.kind === ContentKind.WebinarCourse;\n  const locationIsInPerson =\n    contentItem.kind === ContentKind.InPersonEvent ||\n    contentItem.kind === ContentKind.InPersonEventCourse;\n  const usesContentAccessText =\n    contentItem.kind === ContentKind.WebinarCourse ||\n    contentItem.kind === ContentKind.InPersonEventCourse;\n\n  const partialHydratedContentItem = {\n    ...contentItem,\n    hasUnmetPrerequisites,\n    isActive,\n    timeZone,\n    hasAvailability,\n    isCompleted,\n    isAvailable,\n    isStarted,\n    isNotStarted,\n    isNotCompleted,\n    kindIsScormOrXApi,\n    locationIsOnline,\n    locationIsInPerson,\n    usesContentAccessText\n  };\n\n  const callToAction = getCallToAction(i18n, partialHydratedContentItem);\n\n  let href = getHref(partialHydratedContentItem);\n  try {\n    const parsedCustomFields = JSON.parse(customFields);\n    if (Object.keys(parsedCustomFields).length && href.length > 1) {\n      const urlParams = `sessionFields=${encodeURIComponent(\n        JSON.stringify(Object.entries(parsedCustomFields))\n      )}`;\n\n      href = `${href}?${urlParams}`;\n    }\n  } catch (e) {\n    // handle error\n  }\n\n  let { priceInCents, suggestedRetailPriceInCents } = contentItem;\n  if (contentItem.alternativePricingType === AlternativePricingType.Membership) {\n    // swap price & suggested retail for display purposes\n    const origPriceInCents = priceInCents;\n    priceInCents = suggestedRetailPriceInCents;\n    suggestedRetailPriceInCents = origPriceInCents;\n  }\n\n  return {\n    ...partialHydratedContentItem,\n    callToAction,\n    href,\n    priceInCents,\n    suggestedRetailPriceInCents\n  };\n};\n\ntype PartialHydratedContentItem = Omit<HydratedContentItem, 'callToAction' | 'href'>;\n\nconst getCallToAction = (\n  i18n: I18n,\n  partialHydratedContentItem: PartialHydratedContentItem\n): string => {\n  if (\n    partialHydratedContentItem.hasAvailability &&\n    !partialHydratedContentItem.waitlistingTriggered\n  ) {\n    if (partialHydratedContentItem.coursePresold && partialHydratedContentItem.courseStartDate) {\n      const runs = courseRuns(\n        partialHydratedContentItem.kind,\n        partialHydratedContentItem.courseStartDate,\n        partialHydratedContentItem.courseEndDate,\n        partialHydratedContentItem.timeZone\n      );\n\n      const runStringPrefix = partialHydratedContentItem.usesContentAccessText\n        ? i18n.t('content-access')\n        : `${partialHydratedContentItem.contentTypeLabel} ${i18n.t('runs')}`;\n\n      return `${runStringPrefix} ${runs}`;\n    } else if (\n      partialHydratedContentItem.courseGracePeriodEnded &&\n      partialHydratedContentItem.courseEndDate\n    ) {\n      return `${i18n.t('course-ended')} ${formatTime(\n        partialHydratedContentItem.courseEndDate,\n        partialHydratedContentItem.timeZone,\n        'MMM Do YYYY'\n      )}`;\n    } else if (partialHydratedContentItem.hasUnmetPrerequisites) {\n      return i18n.t('course.prerequisites');\n    } else if (partialHydratedContentItem.bulkPurchasingEnabled) {\n      return i18n.t('course-view-details');\n    } else if (partialHydratedContentItem.isCompleted) {\n      if (partialHydratedContentItem.kind === ContentKind.LearningPath) {\n        return i18n.t('learning-path.view');\n      }\n\n      return i18n.t('view-course', {\n        contentType: partialHydratedContentItem.contentTypeLabel\n      });\n    } else if (partialHydratedContentItem.isStarted) {\n      if (partialHydratedContentItem.kind === ContentKind.LearningPath) {\n        return i18n.t('learning-path.continue');\n      }\n\n      return i18n.t('continue-course');\n    } else if (partialHydratedContentItem.isNotStarted) {\n      if (partialHydratedContentItem.kind === ContentKind.LearningPath) {\n        return i18n.t('learning-path.start');\n      }\n\n      return i18n.t('start-course', {\n        contentType: partialHydratedContentItem.contentTypeLabel\n      });\n    } else if (partialHydratedContentItem.isNotCompleted) {\n      return i18n.t('not-completed-course');\n    }\n\n    return i18n.t('course-view-details');\n  } else if (\n    partialHydratedContentItem.waitlistingTriggered &&\n    partialHydratedContentItem.waitlistingEnabled\n  ) {\n    return i18n.t('join-waitlist');\n  }\n\n  return i18n.t('course-view-details');\n};\n\nconst getHref = (partialHydratedContentItem: PartialHydratedContentItem): string => {\n  const itemKind = partialHydratedContentItem.kind;\n  const itemSlug = partialHydratedContentItem.slug;\n\n  if (itemKind === ContentKind.Product) {\n    return `/products/${itemSlug}`;\n  } else if (itemKind === ContentKind.Bundle) {\n    return `/bundles/${itemSlug}`;\n  } else if (itemKind === ContentKind.PickableGroup) {\n    return `/cart-collections/${itemSlug}`;\n  } else if (itemKind === ContentKind.DiscountGroup) {\n    return `/collections/${itemSlug}`;\n  } else if (itemKind === ContentKind.LearningPath && partialHydratedContentItem.isActive) {\n    if (\n      partialHydratedContentItem.hasAvailability &&\n      !partialHydratedContentItem.bulkPurchasingEnabled\n    ) {\n      return `/learn/learning-path/${itemSlug}`;\n    }\n\n    return `/learning-paths/${itemSlug}`;\n  }\n\n  if (partialHydratedContentItem.isActive) {\n    if (partialHydratedContentItem.hasAvailability) {\n      if (itemKind === ContentKind.ShareableContentObject || itemKind === ContentKind.XApiObject) {\n        if (partialHydratedContentItem.isAvailable) {\n          return `/courses/${itemSlug}`;\n        }\n\n        return '#';\n      } else if (\n        (partialHydratedContentItem.isCompleted || partialHydratedContentItem.isStarted) &&\n        !partialHydratedContentItem.bulkPurchasingEnabled\n      ) {\n        if (itemKind === ContentKind.Webinar) {\n          return `/learn/webinars/${partialHydratedContentItem.displayCourse}/redirect`;\n        } else if (itemKind === ContentKind.Article) {\n          return `/learn/article/${partialHydratedContentItem.displayCourseSlug}`;\n        } else if (itemKind === ContentKind.InPersonEvent) {\n          return `/learn/event/${partialHydratedContentItem.displayCourseSlug}`;\n        } else if (itemKind === ContentKind.Video) {\n          return `/learn/video/${partialHydratedContentItem.displayCourseSlug}`;\n        }\n\n        return `/learn/course/${partialHydratedContentItem.displayCourseSlug}`;\n      } else if (partialHydratedContentItem.isNotStarted) {\n        return `/learn/enroll/${partialHydratedContentItem.displayCourse}`;\n      }\n\n      return `/courses/${itemSlug}`;\n    }\n\n    return `/courses/${itemSlug}`;\n  } else if (itemKind === ContentKind.Webinar || itemKind === ContentKind.InPersonEvent) {\n    // if the webinar hasn't started or has ended,\n    // allow learner to go to webinar detail page to reschedule\n    return `/courses/${itemSlug}`;\n  }\n\n  return '#';\n};\n\nexport default hydrateContentItem;\n"],"names":["AvailabilityStatus","hydrateContentItem","i18n","contentItem","companyTimeZone","customFields","hasUnmetPrerequisites","isActive","timeZone","hasAvailability","isCompleted","isAvailable","isStarted","isNotStarted","isNotCompleted","kindIsScormOrXApi","ContentKind","locationIsOnline","locationIsInPerson","usesContentAccessText","partialHydratedContentItem","callToAction","getCallToAction","href","getHref","parsedCustomFields","urlParams","priceInCents","suggestedRetailPriceInCents","AlternativePricingType","origPriceInCents","runs","courseRuns","formatTime","itemKind","itemSlug"],"mappings":"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"}